---
title: "Low Altitude Economy Development Index"
subtitle: "White Paper 2024"
date: last-modified
author: "Jules AI"
format:
  html:
    toc: true
    code-fold: true
    self-contained: true
    page-layout: full
    theme: cosmo
  pdf:
    toc: true
    number-sections: true
    colorlinks: true
    papersize: a4
    documentclass: scrartcl
---

```{python}
#| label: setup
#| include: false

import pandas as pd
import numpy as np
import data_processing
from pyecharts.charts import Line, Bar, Pie, Map, Radar, Gauge, Funnel, HeatMap, TreeMap, Graph, Polar
from pyecharts import options as opts
from pyecharts.globals import ThemeType
import matplotlib.pyplot as plt
import seaborn as sns
from IPython.display import HTML

# Load data
data_dict = data_processing.generate_mock_data()

# Set style for static plots
sns.set_theme(style="whitegrid")
plt.rcParams['font.sans-serif'] = ['Arial Unicode MS'] # For Chinese support if needed, assuming generic environment
plt.rcParams['axes.unicode_minus'] = False

# Helper to render pyecharts
def render_pyecharts(chart):
    return HTML(chart.render_embed())

```

# Executive Summary

This white paper presents the Low Altitude Economy Development Index, calculated using the 5D framework: Scale, Structure, Space, Efficiency, and Innovation.

::: {.content-visible when-format="html"}
## Dashboard
```{python}
#| label: dashboard-interactive
gauge = (
    Gauge()
    .add("", [("Index", data_dict["dashboard"][0]["value"])], min_=0, max_=100)
    .set_global_opts(title_opts=opts.TitleOpts(title="Composite Index"))
)
render_pyecharts(gauge)
```
:::

::: {.content-visible when-format="pdf"}
## Dashboard
```{python}
#| label: dashboard-static
val = data_dict["dashboard"][0]["value"]
fig, ax = plt.subplots(figsize=(6, 4))
ax.text(0.5, 0.5, f"{val}", fontsize=40, ha='center', va='center', color='#0ea5e9', weight='bold')
ax.text(0.5, 0.3, "Composite Index", fontsize=15, ha='center', va='center', color='gray')
ax.axis('off')
plt.show()
```
:::

# 1. Scale & Growth

## 1.1 Traffic Trends

::: {.content-visible when-format="html"}
```{python}
#| label: traffic-interactive
df_traffic = data_dict["traffic"]
line = (
    Line()
    .add_xaxis(df_traffic["date"].tolist())
    .add_yaxis("Sorties", df_traffic["value"].tolist(), is_smooth=True,
               areastyle_opts=opts.AreaStyleOpts(opacity=0.5))
    .set_global_opts(
        title_opts=opts.TitleOpts(title="Daily Flight Sorties"),
        xaxis_opts=opts.AxisOpts(type_="category"),
        yaxis_opts=opts.AxisOpts(type_="value"),
        tooltip_opts=opts.TooltipOpts(trigger="axis")
    )
)
render_pyecharts(line)
```
:::

::: {.content-visible when-format="pdf"}
```{python}
#| label: traffic-static
df_traffic = data_dict["traffic"]
plt.figure(figsize=(10, 5))
plt.fill_between(df_traffic["date"], df_traffic["value"], color="skyblue", alpha=0.4)
plt.plot(df_traffic["date"], df_traffic["value"], color="SlateBlue", alpha=0.6, linewidth=2)
plt.title("Daily Flight Sorties")
plt.xticks(rotation=45)
plt.xlabel("Date")
plt.ylabel("Sorties")
plt.tight_layout()
plt.show()
```
:::

## 1.2 Operation Intensity

::: {.content-visible when-format="html"}
```{python}
#| label: operation-interactive
df_op = data_dict["operation"]
bar_line = (
    Bar()
    .add_xaxis(df_op["name"].tolist())
    .add_yaxis("Duration (h)", df_op["duration"].tolist(), yaxis_index=0, color="#0ea5e9")
    .extend_axis(
        yaxis=opts.AxisOpts(
            name="Distance (km)",
            type_="value",
            position="right",
            axisline_opts=opts.AxisLineOpts(
                linestyle_opts=opts.LineStyleOpts(color="#10b981")
            )
        )
    )
    .set_global_opts(
        title_opts=opts.TitleOpts(title="Operation Intensity"),
        yaxis_opts=opts.AxisOpts(name="Duration (h)", position="left"),
        tooltip_opts=opts.TooltipOpts(trigger="axis", axis_pointer_type="cross")
    )
)

line_op = (
    Line()
    .add_xaxis(df_op["name"].tolist())
    .add_yaxis("Distance (km)", df_op["distance"].tolist(), yaxis_index=1, color="#10b981", z=10)
)

bar_line.overlap(line_op)
render_pyecharts(bar_line)
```
:::

::: {.content-visible when-format="pdf"}
```{python}
#| label: operation-static
df_op = data_dict["operation"]
fig, ax1 = plt.subplots(figsize=(10, 6))

color = 'tab:blue'
ax1.set_xlabel('Region')
ax1.set_ylabel('Duration (h)', color=color)
ax1.bar(df_op["name"], df_op["duration"], color=color, alpha=0.6)
ax1.tick_params(axis='y', labelcolor=color)

ax2 = ax1.twinx()
color = 'tab:green'
ax2.set_ylabel('Distance (km)', color=color)
ax2.plot(df_op["name"], df_op["distance"], color=color, marker='o', linewidth=2)
ax2.tick_params(axis='y', labelcolor=color)

plt.title("Operation Intensity: Duration vs Distance")
plt.show()
```
:::

# 2. Structure & Entity

## 2.1 Fleet Composition

::: {.content-visible when-format="html"}
```{python}
#| label: fleet-interactive
df_fleet = data_dict["fleet"]
bar_stack = (
    Bar()
    .add_xaxis(df_fleet["name"].tolist())
    .add_yaxis("MultiRotor", df_fleet["MultiRotor"].tolist(), stack="stack1")
    .add_yaxis("FixedWing", df_fleet["FixedWing"].tolist(), stack="stack1")
    .add_yaxis("Helicopter", df_fleet["Helicopter"].tolist(), stack="stack1")
    .set_series_opts(label_opts=opts.LabelOpts(is_show=False))
    .set_global_opts(title_opts=opts.TitleOpts(title="Fleet Composition Trends"))
)
render_pyecharts(bar_stack)
```
:::

::: {.content-visible when-format="pdf"}
```{python}
#| label: fleet-static
df_fleet = data_dict["fleet"]
df_fleet.set_index("name").plot(kind='bar', stacked=True, figsize=(10, 6))
plt.title("Fleet Composition Trends")
plt.ylabel("Count")
plt.show()
```
:::

## 2.2 Market Concentration (Pareto)

::: {.content-visible when-format="html"}
```{python}
#| label: pareto-interactive
df_pareto = data_dict["pareto"]
total = df_pareto["volume"].sum()
df_pareto["cumulative_pct"] = df_pareto["volume"].cumsum() / total * 100

bar_pareto = (
    Bar()
    .add_xaxis(df_pareto["name"].tolist())
    .add_yaxis("Volume", df_pareto["volume"].tolist(), color="#0ea5e9")
    .extend_axis(
        yaxis=opts.AxisOpts(
            name="Cumulative %",
            type_="value",
            min_=0,
            max_=100,
            position="right"
        )
    )
    .set_global_opts(
        title_opts=opts.TitleOpts(title="Market Concentration (Pareto)"),
        tooltip_opts=opts.TooltipOpts(trigger="axis", axis_pointer_type="cross")
    )
)

line_pareto = (
    Line()
    .add_xaxis(df_pareto["name"].tolist())
    .add_yaxis("Cumulative %", df_pareto["cumulative_pct"].round(1).tolist(), yaxis_index=1, color="#f59e0b")
)

bar_pareto.overlap(line_pareto)
render_pyecharts(bar_pareto)
```
:::

::: {.content-visible when-format="pdf"}
```{python}
#| label: pareto-static
df_pareto = data_dict["pareto"]
total = df_pareto["volume"].sum()
df_pareto["cumulative_pct"] = df_pareto["volume"].cumsum() / total * 100

fig, ax1 = plt.subplots(figsize=(10, 6))
ax1.bar(df_pareto["name"], df_pareto["volume"], color="C0")
ax1.set_ylabel("Volume", color="C0")
ax1.tick_params(axis='y', labelcolor="C0")
ax1.tick_params(axis='x', rotation=45)

ax2 = ax1.twinx()
ax2.plot(df_pareto["name"], df_pareto["cumulative_pct"], color="C1", marker="D", ms=5)
ax2.set_ylabel("Cumulative %", color="C1")
ax2.tick_params(axis='y', labelcolor="C1")
ax2.set_ylim(0, 110)

plt.title("Market Concentration")
plt.tight_layout()
plt.show()
```
:::

## 2.3 Commercial Maturity (Rose)

::: {.content-visible when-format="html"}
```{python}
#| label: rose-interactive
df_rose = data_dict["rose"]
rose = (
    Pie()
    .add(
        "",
        [list(z) for z in zip(df_rose["name"], df_rose["value"])],
        radius=["20%", "75%"],
        rosetype="area",
    )
    .set_global_opts(title_opts=opts.TitleOpts(title="Sector Maturity"))
)
render_pyecharts(rose)
```
:::

::: {.content-visible when-format="pdf"}
```{python}
#| label: rose-static
# Matplotlib Polar plot for Rose Chart approximation
# OR simplified Pie chart
df_rose = data_dict["rose"]
plt.figure(figsize=(8, 8))
# Rose chart in matplotlib is a bar chart on polar axis
theta = np.linspace(0.0, 2 * np.pi, len(df_rose), endpoint=False)
radii = df_rose["value"]
width = (2 * np.pi) / len(df_rose)

ax = plt.subplot(111, projection='polar')
bars = ax.bar(theta, radii, width=width, bottom=0.0, alpha=0.6)
ax.set_xticks(theta)
ax.set_xticklabels(df_rose["name"])
plt.title("Sector Maturity")
plt.show()
```
:::

# 3. Time & Space

## 3.1 Regional Heatmap

::: {.content-visible when-format="html"}
```{python}
#| label: map-interactive
df_map = data_dict["map"]
# Note: This requires the map assets for 'Shenzhen' or custom geojson to be registered in Pyecharts.
# Here we use a generic Map with a note, or assume 'China' -> 'Guangdong' -> 'Shenzhen' maps are available.
# Pyecharts usually requires separate installation of maps.
# For demo, we might use a HeatMap on coordinates if map assets missing, but let's try standard Map.
# Assuming we have registered "Shenzhen". If not, it won't render the shapes but will show the logic.
# Alternatively, use BMap (Baidu Map) if internet allowed, but here we stick to offline capable if assets installed.

c_map = (
    Map()
    .add("Sorties", [list(z) for z in zip(df_map["name"], df_map["value"])], "深圳")
    .set_global_opts(
        title_opts=opts.TitleOpts(title="Regional Flight Distribution"),
        visualmap_opts=opts.VisualMapOpts(max_=100),
    )
)
# render_pyecharts(c_map)
# Commented out because specific Shenzhen map assets might be missing in this environment.
# Using a fallback Bar chart for "Map" representation in this strict environment,
# or a Heatmap of X/Y if we had coords.
print("Interactive Map requires custom assets or GeoJSON registration. Displaying data table instead.")
df_map
```
:::

::: {.content-visible when-format="pdf"}
```{python}
#| label: map-static
# Geopandas plotting
# In a real scenario: gdf = gpd.read_file('shenzhen.geojson').merge(df_map, on='name')
# gdf.plot(column='value', legend=True)
# Here, purely mock:
plt.figure(figsize=(8, 6))
plt.barh(df_map["name"], df_map["value"], color='teal')
plt.title("Regional Flight Distribution (Map Proxy)")
plt.xlabel("Sorties")
plt.show()
```
:::

## 3.2 Calendar Heatmap

::: {.content-visible when-format="html"}
```{python}
#| label: calendar-interactive
df_cal = data_dict["calendar"]
# Pyecharts Calendar
cal = (
    HeatMap() # Using HeatMap or Calendar chart
    # Actually pyecharts has Calendar
)
# Re-import Calendar
from pyecharts.charts import Calendar

cal_chart = (
    Calendar()
    .add("", [[d, v] for d, v in zip(df_cal["date"], df_cal["value"])], calendar_opts=opts.CalendarOpts(range_="2023"))
    .set_global_opts(
        title_opts=opts.TitleOpts(title="Flight Intensity Calendar"),
        visualmap_opts=opts.VisualMapOpts(max_=1000, orient="horizontal", is_piecewise=False),
    )
)
render_pyecharts(cal_chart)
```
:::

::: {.content-visible when-format="pdf"}
```{python}
#| label: calendar-static
# Seaborn heatmap reshaping
df_cal = data_dict["calendar"]
df_cal["dt"] = pd.to_datetime(df_cal["date"])
df_cal["month"] = df_cal["dt"].dt.month
df_cal["day"] = df_cal["dt"].dt.day
pivot_cal = df_cal.pivot(index="month", columns="day", values="value")

plt.figure(figsize=(12, 6))
sns.heatmap(pivot_cal, cmap="OrRd", cbar_kws={'label': 'Sorties'})
plt.title("Daily Flight Intensity Heatmap")
plt.show()
```
:::

## 3.3 Polar Clock

::: {.content-visible when-format="html"}
```{python}
#| label: polar-interactive
df_polar = data_dict["polar"]
polar = (
    Polar()
    .add_schema(angleaxis_opts=opts.AngleAxisOpts(data=df_polar["hour"].tolist(), type_="category"))
    .add("Activity", df_polar["value"].tolist(), type_="bar", stack="stack0")
    .set_global_opts(title_opts=opts.TitleOpts(title="24H Activity (Polar)"))
)
render_pyecharts(polar)
```
:::

::: {.content-visible when-format="pdf"}
```{python}
#| label: polar-static
df_polar = data_dict["polar"]
N = len(df_polar)
theta = np.linspace(0.0, 2 * np.pi, N, endpoint=False)
radii = df_polar["value"]
width = 2 * np.pi / N

ax = plt.subplot(111, projection='polar')
bars = ax.bar(theta, radii, width=width, bottom=0.0)
ax.set_xticks(theta[::4]) # tick every 4 hours
ax.set_xticklabels(df_polar["hour"][::4])
plt.title("24H Activity")
plt.show()
```
:::

# 4. Efficiency & Quality

## 4.1 Seasonal Analysis (Box Plot)

::: {.content-visible when-format="html"}
```{python}
#| label: boxplot-interactive
from pyecharts.charts import Boxplot
df_sea = data_dict["seasonal"]
# Prepare data [min, Q1, median, Q3, max]
y_data = []
for i, row in df_sea.iterrows():
    y_data.append([row["min"], row["q1"], row["median"], row["q3"], row["max"]])

box = (
    Boxplot()
    .add_xaxis(df_sea["name"].tolist())
    .add_yaxis("Variability", boxplot_data=box.prepare_data(y_data)) # This uses raw data usually, but here we have pre-calc stats.
    # Pyecharts Boxplot.prepare_data takes raw samples.
    # Since we have stats, we might need custom data injection or just use simplified Boxplot logic if Pyecharts supports it.
    # Actually, add_yaxis can take direct [min, Q1, mid, Q3, max] lists if we bypass prepare_data.
)
# Creating a new Boxplot without prepare_data helper for pre-calculated stats
box = (
    Boxplot()
    .add_xaxis(df_sea["name"].tolist())
    .add_yaxis("Sorties Distribution", y_data)
    .set_global_opts(title_opts=opts.TitleOpts(title="Seasonal Variability"))
)
render_pyecharts(box)
```
:::

::: {.content-visible when-format="pdf"}
```{python}
#| label: boxplot-static
# Matplotlib boxplot requires raw data usually, or we use bxp
stats = []
df_sea = data_dict["seasonal"]
for i, row in df_sea.iterrows():
    stats.append({
        'label': row["name"],
        'whislo': row["min"],
        'q1': row["q1"],
        'med': row["median"],
        'q3': row["q3"],
        'whishi': row["max"],
        'fliers': []
    })

fig, ax = plt.subplots(figsize=(10, 6))
ax.bxp(stats, showfliers=False)
plt.title("Seasonal Variability")
plt.ylabel("Sorties")
plt.show()
```
:::

# 5. Innovation & Integration

## 5.1 Leading Entities (Radar)

::: {.content-visible when-format="html"}
```{python}
#| label: radar-interactive
df_radar = data_dict["radar"]
radar = (
    Radar()
    .add_schema(
        schema=[
            opts.RadarIndicatorItem(name=n, max_=100) for n in df_radar["subject"]
        ]
    )
    .add("Company A", [df_radar["A"].tolist()], color="#0ea5e9")
    .add("Company B", [df_radar["B"].tolist()], color="#10b981")
    .set_global_opts(title_opts=opts.TitleOpts(title="Entity Capability Comparison"))
)
render_pyecharts(radar)
```
:::

::: {.content-visible when-format="pdf"}
```{python}
#| label: radar-static
labels = np.array(df_radar["subject"])
stats_a = df_radar["A"].values
stats_b = df_radar["B"].values

angles = np.linspace(0, 2*np.pi, len(labels), endpoint=False).tolist()
stats_a = np.concatenate((stats_a,[stats_a[0]]))
stats_b = np.concatenate((stats_b,[stats_b[0]]))
angles += angles[:1]

fig, ax = plt.subplots(figsize=(6, 6), subplot_kw=dict(polar=True))
ax.fill(angles, stats_a, color='blue', alpha=0.25)
ax.plot(angles, stats_a, color='blue', label='Company A')
ax.fill(angles, stats_b, color='green', alpha=0.25)
ax.plot(angles, stats_b, color='green', label='Company B')
ax.set_yticklabels([])
ax.set_xticks(angles[:-1])
ax.set_xticklabels(labels)
plt.title("Entity Capability Comparison")
plt.legend(loc='upper right', bbox_to_anchor=(0.1, 0.1))
plt.show()
```
:::

## 5.2 Micro Circulation (Chord)

::: {.content-visible when-format="html"}
```{python}
#| label: chord-interactive
# Using Graph or Sankey for Chord-like representation in Pyecharts
df_chord = data_dict["chord"]
nodes = sorted(list(set([d['source'] for d in df_chord] + [d['target'] for d in df_chord])))
nodes_data = [{"name": n} for n in nodes]
links_data = [{"source": d['source'], "target": d['target'], "value": d['value']} for d in df_chord]

graph = (
    Graph()
    .add("", nodes_data, links_data, repulsion=5000, layout="circular", is_rotate_label=True)
    .set_global_opts(title_opts=opts.TitleOpts(title="Regional Micro-circulation"))
)
render_pyecharts(graph)
```
:::

::: {.content-visible when-format="pdf"}
```{python}
#| label: chord-static
# Chord diagram is hard in matplotlib. We can use a NetworkX circular layout + curve edges
import networkx as nx
G = nx.DiGraph()
for d in df_chord:
    G.add_edge(d['source'], d['target'], weight=d['value'])

pos = nx.circular_layout(G)
plt.figure(figsize=(6, 6))
nx.draw(G, pos, with_labels=True, node_size=2000, node_color="skyblue", font_size=10, width=[d['weight']/10 for u,v,d in G.edges(data=True)])
plt.title("Regional Micro-circulation")
plt.show()
```
:::
